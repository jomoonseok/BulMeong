<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/header::head('BulMeong')}"></head>
<head>
	<script>
		$(document).ready(function(){
			fn_findId();
		});
		
		var namePass = false;
		var emailPass = false;
		
		function fn_findId(){
			
			if(namePass == false){
				$('#name').keyup(function(){
					let nameValue = $('#name').val();
					let regName = /^[가-힣]{2,17}$/;
					
					if(nameValue != '' && regName.test(nameValue) == true){
						$('#msg_name').text('');
						namePass = true;
					} else {
						$('#msg_name').text('이름은 한글만 입력할 수 있습니다.');
						namePass = false;
						return;
					}
				});
			}
			
			if(emailPass == false){
				$('#email').keyup(function(){
					let emailValue = $('#email').val();
					let regEmail = /^[a-zA-Z0-9-_]+@[a-zA-Z0-9]+(\.[a-zA-Z]{2,}){1,2}$/;
					
					if (emailValue != '' && regEmail.test(emailValue) == true){
						$('#msg_email').text('');
						emailPass = true;
					} else {
						$('#msg_email').text('이메일 형식을 확인하세요.');
						emailPass = false;
						return;
					}
				});
			}
			
			
			$('#btn_findId').click(function(){
				
				$.ajax({
					url: '/users/findId',
					type: 'POST',
					contentType: 'application/json',
					data: JSON.stringify({
						name: $('#name').val(),
						email: $('#email').val()
					}),
					dataType: 'json',
					success: function(resData) {
						if (resData.findUser != null) {
							let id = resData.findUser.id;
							id = id.substring(0, 3) + '*****';
							console.log(resData.findUser.joinDate);
							moment.locale('ko-KR');
							$('#msg_result').html('회원님의 아이디는 ' + id + '입니다.<br>(가입일 : ' + resData.findUser.joinDate + ')');
						} else {
							$('#msg_result').html('일치하는 회원이 없습니다. 입력 정보를 확인하세요.');
						}
					}
				});
			});
			
		}
		
		/* function fn_join(){
			if(namePass == false){
				alert('이름을 확인하세요.');
				event.preventDefault();
				return;
			} else if(emailPass == false){
				alert('이메일 인증을 받으세요.');
				event.preventDefault();
				return;
			}
		} */
	</script>
</head>
<body>

	<header th:replace="~{layout/header::header_layout}"></header>
	
	<h1>아이디 찾기</h1>
	
	<div>
		<label for="name">
			*이름<br>
			<input type="text" name="name" id="name">
		</label>
		<span id="msg_name"></span>
	</div>
	
	<div>
		<label for="email">
			*이메일<br>
			<input type="text" name="email" id="email">
		</label>
		<span id="msg_email"></span>
	</div>
	
	<div>
		<input type="button" value="아이디찾기" id="btn_findId">
	</div>
	
	<div>
		<a th:href="@{/users/login/form}">로그인</a> / 
		<a th:href="@{/users/findPw/form}">비밀번호 찾기</a> /
		<a th:href="@{/users/agree}">회원가입</a>
	</div>
	
	<hr>
	
	<div id="msg_result"></div>
	
</body>
</html>